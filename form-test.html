<!DOCTYPE html>
<html>
<head>
    <title>Google Form Submission Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input, select { width: 100%; padding: 8px; box-sizing: border-box; }
        button { background: #4285f4; color: white; border: none; padding: 10px 15px; cursor: pointer; }
        #response { margin-top: 20px; padding: 10px; border-radius: 4px; }
        .success { background: #e6f4ea; color: #1e8e3e; }
        .error { background: #fce8e6; color: #d93025; }
    </style>
</head>
<body>
    <h1>Form Submission Test</h1>
    
    <div class="form-group">
        <label for="item">Item Name:</label>
        <input type="text" id="item" value="Test Product">
    </div>
    
    <div class="form-group">
        <label for="unit">Unit:</label>
        <select id="unit">
            <option value="ct">Carton (Ct)</option>
            <option value="dz">Dozen (Dz)</option>
            <option value="pc" selected>Piece (Pc)</option>
        </select>
    </div>
    
    <div class="form-group">
        <label for="quantity">Quantity:</label>
        <input type="number" id="quantity" value="1">
    </div>
    
    <div class="form-group">
        <label for="price">Price:</label>
        <input type="number" id="price" value="100">
    </div>
    
    <button onclick="submitTest()">Test Submission</button>
    
    <div id="response"></div>

    <script>
        async function submitTest() {
            const responseDiv = document.getElementById('response');
            responseDiv.innerHTML = "Submitting...";
            responseDiv.className = "";
            
            try {
                const sale = {
                    item: document.getElementById('item').value,
                    unit: document.getElementById('unit').value,
                    quantity: document.getElementById('quantity').value,
                    price: document.getElementById('price').value,
                    discount: 0,
                    extra: 0,
                    total: document.getElementById('quantity').value * document.getElementById('price').value,
                    paymentMethod: "Cash",
                    productId: 1, // Mock product ID
                    store: "Test Store"
                };

                // Use the same submission function from your POS
                await submitSaleToGoogleForm(sale);
                
                responseDiv.innerHTML = "✅ Submission successful! Check your Google Form responses.";
                responseDiv.className = "success";
                
                console.log("Test submission successful:", sale);
            } catch (error) {
                responseDiv.innerHTML = "❌ Submission failed: " + error.message;
                responseDiv.className = "error";
                
                console.error("Test submission failed:", error);
            }
        }

        // This matches your POS implementation
        async function submitSaleToGoogleForm(sale) {
            const baseUrl = "https://docs.google.com/forms/d/e/1FAIpQLScGs3PzOn2vABptL5aHssXw2si3Nl_j5tInqr-3X_K_8a2lsw/formResponse";
            const params = new URLSearchParams();
            
            params.append("fvv", "1");
            params.append("pageHistory", "0");
            params.append("submit", "Submit");

            params.append("entry.530043741", sale.item);
            params.append("entry.1375268000", sale.unit);
            params.append("entry.782910412", sale.quantity);
            params.append("entry.1738189165", sale.price);
            params.append("entry.1117472858", sale.discount || 0);
            params.append("entry.821166726", sale.extra || 0);
            params.append("entry.392694852", sale.total);
            params.append("entry.1649210669", sale.paymentMethod);
            params.append("entry.1206379884", sale.store);
            params.append("entry.1846424292", 99); // Mock stock value

            const submissionUrl = `${baseUrl}?${params.toString()}`;

            // Method 1: Iframe submission (recommended)
            return new Promise((resolve, reject) => {
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = submissionUrl;
                
                iframe.onload = () => {
                    setTimeout(() => {
                        document.body.removeChild(iframe);
                        resolve();
                    }, 1000);
                };
                
                iframe.onerror = () => {
                    document.body.removeChild(iframe);
                    reject(new Error('Iframe submission failed'));
                };
                
                document.body.appendChild(iframe);
            });
        }
    </script>
</body>
</html>
